<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Bike Shop UI</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="user">
            <span class="icon">ðŸ‘¤</span>
            <span>Hello there, <b>Juan Dela Cruz</b></span>
        </div>
        <div class="menu">
            <span class="icon">â˜°</span>
        </div>
    </header>

    <!-- Search Bar -->
    <div class="search-container">
        <input type="text" placeholder="Looking for something?">
        <span class="filter">âš²</span>
    </div>

    <!-- Newly Released Products -->
    <section class="new-products">
        <div class="text">
            <h2>Explore Our Newly Released Products</h2>
            <button>View All â†’</button>
        </div>
        <div class="product-banner">
            <div class="highlight"></div>
        </div>
    </section>

    <!-- Recommended -->
    <section class="section">
        <div class="section-header">
            <h3>RECOMMENDED FOR YOU</h3>
            <a href="#">See All</a>
        </div>
        <div class="card-container">
            <div class="card"></div>
            <div class="card"></div>
            <div class="card"></div>
            <div class="card"></div>
        </div>
    </section>

    <!-- E-Bikes -->
    <section class="section">
        <div class="section-header">
            <h3>E-BIKES</h3>
            <a href="#">See All</a>
        </div>
        <div class="card-container">
            <div class="card"></div>
            <div class="card"></div>
        </div>
    </section>

    <!-- Parts -->
    <section class="section">
        <div class="section-header">
            <h3>PARTS</h3>
            <a href="#">See All</a>
        </div>
        <div class="card-container">
            <div class="card"></div>
            <div class="card"></div>
        </div>
    </section>

    <!-- Accessories -->
    <section class="section">
        <div class="section-header">
            <h3>ACCESSORIES</h3>
            <a href="#">See All</a>
        </div>
        <div class="card-container">
            <div class="card"></div>
            <div class="card"></div>
            <div class="card"></div>
        </div>
    </section>

    <!-- Chatbot -->
        <div id="chat-icon" onclick="toggleChat()">
          <img src="C:\Users\user\Downloads\SpeegoPal Homepage\SpeegoPal.png" alt="SpeegoPal Chatbot" id="chatbot-img">
        </div>

    <!-- Chatbox Container -->
        <div id="chatbox">
          <div id="chat-header">
          <span>Chat with SpeegoPal</span>
          <button id="minimizeBtn">âž–</button>
        </div>
          <div id="chatLog"></div>
          <div id="chat-input">
            <input type="text" id="userInput" placeholder="Ask me anything..." />
            <button onclick="sendMessage()">Send</button>
          </div>
        </div>

<script>
  function toggleChat() {
    const chatbox = document.getElementById('chatbox');
    const chatLog = document.getElementById('chatLog');

    // Toggle visibility
    chatbox.classList.toggle('active');

    // Show welcome message only once
    if (chatbox.classList.contains('active') && chatLog.innerHTML.trim() === '') {
      chatLog.innerHTML = `<p><strong>SpeegoPal:</strong> Hello! I'm SpeegoPal, your e-bike assistant. How can I help you today?</p>`;
    }
  }

  document.getElementById('minimizeBtn').addEventListener('click', () => {
    document.getElementById('chatbox').classList.remove('active');
  });

  async function sendMessage() {
    const input = document.getElementById('userInput');
    const message = input.value.trim();
    if (!message) return;

    // Clear input immediately
    input.value = '';

    // Show user message
    const chatLog = document.getElementById('chatLog');
    chatLog.innerHTML += `<p><strong>You:</strong> ${message}</p>`;

    // Show typing animation
    const typingIndicator = document.createElement('p');
    typingIndicator.id = 'typing';
    typingIndicator.innerHTML = `<strong>SpeegoPal:</strong> <em>Typing...</em>`;
    chatLog.appendChild(typingIndicator);
    chatLog.scrollTop = chatLog.scrollHeight;

    // Send to Flask backend
    const response = await fetch('http://127.0.0.1:5000/chat', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({message})
    });

    const data = await response.json();

    // Remove typing animation
    typingIndicator.remove();

    // Show bot response
    chatLog.innerHTML += `<p><strong>SpeegoPal:</strong> ${data.reply}</p>`;
    chatLog.scrollTop = chatLog.scrollHeight;
  }

    // Listen for Enter key
    document.addEventListener('DOMContentLoaded', () => {
      const input = document.getElementById('userInput');
      input.addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
          sendMessage();
      }
    });
  });
</script>

<script>
  document.addEventListener('DOMContentLoaded', async () => {
    const customerId = 1; // Replace with actual logged-in customer ID
    const container = document.querySelector('.section:nth-of-type(2) .card-container'); // "Recommended for You"

    try {
      const response = await fetch(`http://127.0.0.1:5000/recommendations/${customerId}`);
      const data = await response.json();

      container.innerHTML = ''; // Clear placeholder cards

      if (data.recommendations.length === 0) {
        container.innerHTML = '<p>No recommendations available right now.</p>';
        return;
      }

      data.recommendations.forEach(item => {
        const card = document.createElement('div');
        card.classList.add('card');
        card.innerHTML = `
          <div class="card-image">
            <img src="images/${item.ProductID}.jpg" alt="${item.Product_Name}" onerror="this.src='default.jpg'">
          </div>
          <div class="card-info">
            <h4>${item.Product_Name}</h4>
            <p>${item.Category}</p>
            <p><strong>â‚±${item.Price}</strong></p>
          </div>
        `;
        container.appendChild(card);
      });
    } catch (error) {
      console.error('Error loading recommendations:', error);
      container.innerHTML = '<p>Unable to load recommendations.</p>';
    }
  });
</script>


</body>

</html>
